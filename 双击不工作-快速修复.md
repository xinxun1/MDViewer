# 🔧 双击不工作 - 快速修复方案

## ⚡ 立即尝试这 3 个方法

### 方法 1: 强制刷新 (最常见)

```
按 Ctrl + F5
```

这会清除缓存并重新加载所有 JS 和 CSS 文件。

---

### 方法 2: 查看控制台日志

1. 按 `F12` 打开开发者工具
2. 切换到 **Console** 标签
3. 刷新页面并打开 UML 文档
4. 查看是否有 **红色错误**

**应该看到的正常日志：**
```
[Zoom] 初始化缩放功能...
[Zoom] 缩放功能初始化完成
[Preview] 找到 3 个 Mermaid 元素待渲染
[Preview] 开始渲染 Mermaid 图表...
[Preview] Mermaid 渲染完成，准备绑定事件
[Zoom] 找到 3 个 Mermaid 图表
[Zoom] 已为图表 0 绑定双击事件
[Zoom] 已为图表 1 绑定双击事件
[Zoom] 已为图表 2 绑定双击事件
```

**如果看到错误，请把错误信息告诉我！**

---

### 方法 3: 紧急修复脚本

**如果前两个方法都不行**，在控制台 (F12 → Console) 粘贴以下代码并回车：

```javascript
// 紧急修复 - 强制绑定双击事件
document.querySelectorAll('.mermaid').forEach((diagram, i) => {
    diagram.style.cursor = 'zoom-in';
    diagram.title = '双击放大查看';
    diagram.addEventListener('dblclick', function() {
        console.log('图表被双击!');
        const modal = document.getElementById('diagramZoomModal');
        const content = document.getElementById('zoomContent');
        const clone = this.cloneNode(true);
        clone.style.cursor = 'default';
        content.innerHTML = '';
        content.appendChild(clone);
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
    });
    console.log(`✓ 图表 ${i} 修复完成`);
});

// 绑定关闭按钮
document.getElementById('zoomClose').onclick = () => {
    document.getElementById('diagramZoomModal').classList.remove('show');
    document.body.style.overflow = '';
};

document.getElementById('diagramZoomModal').onclick = (e) => {
    if (e.target.id === 'diagramZoomModal') {
        e.target.classList.remove('show');
        document.body.style.overflow = '';
    }
};

console.log('✅ 紧急修复完成！现在试试双击图表');
```

执行后，再次尝试双击图表。

---

## 🔍 诊断工具

### 快速检查命令

**在控制台依次执行以下命令：**

```javascript
// 1. 检查有多少个图表
document.querySelectorAll('.mermaid').length
// 应该返回大于 0 的数字

// 2. 检查模态框是否存在
document.getElementById('diagramZoomModal')
// 应该返回一个 div 元素，不是 null

// 3. 检查是否有绑定的事件
document.querySelector('.mermaid')._zoomHandler
// 应该返回 function 或 undefined

// 4. 手动触发打开（测试功能是否正常）
window.mdViewer.openDiagramZoom(document.querySelector('.mermaid'))
// 应该打开缩放模态框
```

---

## 🐛 常见错误及解决方案

### 错误 1: `Cannot read property 'addEventListener' of null`

**原因**：HTML 中缺少模态框元素

**解决**：
1. 打开 `standalone.html`
2. 搜索 `diagramZoomModal`
3. 如果没有找到，说明 HTML 文件没有更新
4. 需要重新添加模态框结构（位于文件末尾，`</body>` 标签之前）

---

### 错误 2: `Mermaid is not defined`

**原因**：Mermaid 库未加载

**解决**：
1. 检查网络连接
2. 打开 Network 标签，刷新页面
3. 查找 `mermaid.min.js` 是否加载成功（状态应该是 200）
4. 如果失败，可能是 CDN 被屏蔽

---

### 错误 3: 图表显示为代码，不是图形

**原因**：Mermaid 渲染器配置错误

**检查**：右键检查图表，查看 HTML 结构

**错误的结构**：
```html
<pre><code class="language-mermaid">...</code></pre>
```

**正确的结构**：
```html
<div class="mermaid"><svg>...</svg></div>
```

**解决**：需要修改 `initMarked()` 中的 `renderer.code`

---

### 错误 4: 双击选中了文字

**原因**：浏览器默认双击行为

**临时解决**：在控制台执行
```javascript
document.querySelectorAll('.mermaid').forEach(el => {
    el.style.userSelect = 'none';
});
```

---

## 📁 测试文件

### test-zoom.html
- 独立的测试页面
- 包含自动检测功能
- 可以验证缩放功能是否正常

### debug-zoom.html  
- 调试工具页面
- 提供详细的诊断信息
- 可以复制日志

### docs/zoom-debug-guide.md
- 完整的调试指南
- 详细的故障排查步骤
- 包含所有可能的错误情况

---

## 💬 反馈格式

如果问题仍未解决，请提供：

```
浏览器: Chrome 120 / Edge 120 / Firefox 120
错误信息: [粘贴控制台的红色错误]
检查结果: 
  - document.querySelectorAll('.mermaid').length = ?
  - document.getElementById('diagramZoomModal') = ?
  - 图表结构: <div> 还是 <pre>?
```

---

## ✅ 成功标志

当一切正常时：
- ✓ 控制台无红色错误
- ✓ 鼠标悬停图表时光标变为 🔍
- ✓ 双击图表弹出黑色半透明背景的模态框
- ✓ 图表显示在模态框中央
- ✓ 可以使用 +/- 按钮缩放
- ✓ ESC 键可以关闭

---

**现在开始调试吧！** 🚀

按 `Ctrl + F5` → 打开 F12 控制台 → 打开 UML 文档 → 查看日志 → 双击图表
