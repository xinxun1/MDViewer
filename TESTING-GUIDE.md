# 最近打开文件夹功能 - 测试指南

## 功能说明

我在这次PR中实现了一个**最近打开文件夹**功能，允许你保存和快速切换最近访问的10个目录。

### 我做了什么？

#### 1. 数据库升级
- 将 IndexedDB 从 v1 升级到 v2
- 新增了 `recentFolders` 存储空间
- 每个文件夹保存：句柄、名称、时间戳

#### 2. UI 改进
- 在侧边栏添加了"最近打开"区域（在"打开文件夹"按钮下方）
- 显示最近打开的文件夹列表
- 当前活动文件夹会用蓝色高亮显示
- 鼠标悬停时显示删除按钮（×）

#### 3. 核心功能
- **自动保存**：每次打开文件夹时自动保存到历史记录
- **快速切换**：点击文件夹名称即可切换到该目录
- **智能管理**：最多保存10个，超过后自动删除最旧的
- **去重处理**：重复打开同一文件夹会更新时间戳

---

## 如何测试

### 测试环境要求

**浏览器**：
- ✅ Chrome 86+ 
- ✅ Edge 86+
- ❌ Firefox（不支持 File System Access API）
- ❌ Safari（不支持 File System Access API）

### 测试步骤

#### 第一步：打开应用

```bash
# 方式1：直接打开 standalone.html
在 Chrome/Edge 浏览器中打开文件：
/home/runner/work/MDViewer/MDViewer/standalone.html

# 方式2：使用 HTTP 服务器
cd /home/runner/work/MDViewer/MDViewer
python3 -m http.server 8080
# 然后访问 http://localhost:8080/standalone.html
```

#### 第二步：测试基本功能

**测试1：添加第一个文件夹**

1. 点击左侧边栏的"打开文件夹"按钮
2. 选择一个包含 Markdown 文件的文件夹（比如 `docs` 文件夹）
3. 观察效果：
   - ✅ 文件树显示该文件夹下的所有 .md 文件
   - ✅ 侧边栏出现"最近打开"区域
   - ✅ 该文件夹显示在列表中，并被蓝色高亮

**测试2：添加更多文件夹**

1. 再次点击"打开文件夹"
2. 选择另一个不同的文件夹
3. 观察效果：
   - ✅ "最近打开"列表现在显示2个文件夹
   - ✅ 最新打开的文件夹排在最前面
   - ✅ 当前活动的文件夹被高亮

**测试3：快速切换文件夹**

1. 在"最近打开"列表中找到之前打开的文件夹
2. 点击文件夹名称或前面的文件夹图标
3. 观察效果：
   - ✅ 文件树立即更新，显示该文件夹的内容
   - ✅ 该文件夹现在被蓝色高亮
   - ✅ 顶部显示当前文件夹名称

**测试4：删除历史记录**

1. 将鼠标悬停在任意文件夹项上
2. 观察右侧出现删除按钮（×）
3. 点击删除按钮
4. 观察效果：
   - ✅ 该文件夹从列表中消失
   - ✅ 如果删除的不是当前文件夹，界面保持不变
   - ✅ 显示提示消息："已从列表中移除"

**测试5：测试10个文件夹限制**

1. 尝试打开10个以上不同的文件夹
2. 观察效果：
   - ✅ 列表最多显示10个文件夹
   - ✅ 当添加第11个文件夹时，最旧的会被自动删除

**测试6：权限处理**

1. 关闭浏览器
2. 重新打开 standalone.html
3. 观察效果：
   - ✅ "最近打开"列表仍然显示之前的文件夹
   - ✅ 如果权限过期，点击文件夹时会提示重新授权

---

## 预期效果截图

### 初始状态
- 侧边栏只显示"打开文件夹"和"刷新"按钮
- 没有"最近打开"区域

### 打开文件夹后
- 出现"最近打开"区域
- 显示文件夹列表
- 当前文件夹高亮显示

### 鼠标悬停
- 文件夹背景变浅灰色
- 右侧显示删除按钮（×）

### 多个文件夹
- 按时间倒序排列（最新的在最前）
- 当前活动的有蓝色高亮

---

## 常见问题排查

### Q1: 看不到"最近打开"区域？
**原因**：还没有打开任何文件夹
**解决**：点击"打开文件夹"并选择一个目录

### Q2: 点击文件夹名称没反应？
**原因**：可能权限过期
**解决**：查看浏览器是否弹出权限请求，点击允许

### Q3: 关闭浏览器后历史记录消失？
**原因**：浏览器可能禁用了 IndexedDB
**解决**：
- 检查浏览器设置中是否启用了 IndexedDB
- 不要使用隐私模式/无痕模式

### Q4: 文件夹名称显示不完整？
**解决**：鼠标悬停在文件夹名称上，会显示完整名称（tooltip）

---

## 技术细节（给开发者）

### 修改的文件
1. `standalone.html` - 添加 UI 容器
2. `public/js/standalone-app.js` - 核心逻辑（约200行）
3. `public/css/style.css` - 样式

### 数据结构
```javascript
{
  id: 1,                              // 自增ID
  handle: FileSystemDirectoryHandle,  // 文件夹句柄
  name: "project-docs",              // 文件夹名称
  timestamp: 1705024000000           // 时间戳
}
```

### 关键代码位置
- 添加文件夹：`addToRecentFolders()` (行 ~150)
- 加载列表：`loadRecentFolders()` (行 ~230)
- 渲染UI：`renderRecentFolders()` (行 ~250)
- 切换文件夹：`switchToFolder()` (行 ~300)
- 删除记录：`removeRecentFolder()` (行 ~330)

---

## 快速测试脚本

如果你想快速验证功能，可以按以下顺序操作：

```
1. 打开 standalone.html
2. 点击"打开文件夹" → 选择 docs 文件夹 → 确认"最近打开"出现
3. 再次点击"打开文件夹" → 选择其他文件夹 → 确认列表有2项
4. 点击第一个文件夹名称 → 确认切换成功
5. 鼠标悬停在任意文件夹 → 点击 × → 确认删除成功
6. 关闭浏览器 → 重新打开 → 确认历史记录保留
```

---

## 文档位置

更详细的文档请查看：
- `docs/recent-folders-feature.md` - 功能说明
- `docs/recent-folders-demo.md` - 使用演示（带流程图）
- `docs/recent-folders-implementation-summary.md` - 技术实现总结
- `CHANGELOG.md` - 版本更新日志（v1.7.0）

---

## 需要帮助？

如果测试过程中遇到任何问题，请：
1. 查看浏览器控制台是否有错误信息
2. 确认浏览器版本符合要求
3. 在 GitHub Issue 中描述具体问题
